# SSH Protocol

Secure Shell Protocol.

Like HTTP, HTTPS, FTP are protocols, SSH is also a protocol.

THe SSH is a protocol that is used to communicate between shell/terminal.

To communicate we use the terminal command `ssh {user}@{host}`.

## Encryption

* Symmetrical Encryption : A single key is used at client and server to encrypt and decrypt the message.

* Asymmetrical Encryption : Use two different keys, public and private key. A public key is spend by both client and server and this public key is used to encrypt the message, which when recieved can be decrypted by the private key stored. As there is no exchange of private keys and there is no way to get the private key from public key, the connection is secured.

Asymmetric Encryption is time consuming hence it is used only to exchange Symmetrical key in most cases.

In SSH Asymmetrical Encryption is used initially to from a Symmetrical Encryption key. The Symmetrical key not exchanged but generated by using Difiie Hellman key Exchange.

* Hashing : Hashing is used to authenticate that the message content is not tempered while transimission.

## Create and use SSH Keys

We have a folder `~/.ssh` in the user folder of the operating system that holds all the SSH keys that we may have generated.

To check existence of previously created/existing SSH keys use `ls -al ~/.ssh` in the terminal or on windows use git-bash. This will give us the list of all the files in the folder.

The folder contains `config id_rsa id_rsa.pub key_backup/ known_hosts` etc folders in it.

We can use `ssh-keygen -t rsa -b 4096 -C "emailaddress@email.com"`. `-t` is used to specify the type of encryption algorithm used. Here we use the rsa algorithm but we can also use DSA, ECDSA, ed25519 algorithm.

In most modern system we use ed25519 algorithm and is also recommended by github. `ssh-keygen -t ed25519 -C "your_email@example.com"`

`-C` => comment, provides a new Comment.

Once we press Enter, we will be asked where the key needs to be saved. If there are other keys we can rename the `id_rsa` file for that specific use case.
`Enter file in which to save key(/Users/Adwait/.ssh/id_rsa): /Users/Adwait/.ssh/id_rsa_git`.

We can have an additional password for this but we don't need it mostly.

We can then use the public part of the key(File marked with `.pub`) that we generated and add it to the any servers authorized_keys.

To changing the passphrase of existing key we use `ssh-keygen -p -f ~/.ssh/id_ed25519`.

Adding the created ssh key to the `ssh-agent` we use `ssh-add ~/.ssh/<private_key_file>` like `ssh-add ~/.ssh/id_ed25519` but before that start the ssh-agent in the background `eval "$(ssh-agent -s)"`.

Once the key is added we can use `ssh-add -L` to get a list of all the keys that are managed by our ssh-agent.

Lets say we have two ssh keys for github and bitbucket and we want to check what ssh key is being use to connect with bitbucket we can do that by using `ssh -v git@bitbucket.org` or to check the connection with github we can use `ssh -T git@github.com`. Then we can check the bitbucket account to see that key we have registered with it to see if they both are the same.

So we use the `-T` tag to check the connection and we use the `-v` tag to check which public key was offered for the connection. We can also use the `-i` tag to specify which key needs to be provided.

When we have multiple identity files that we want to use for different sites we can also create a configuration file for ssh in the `~/.ssh/config` and configure ssh to use the required identities.

```config
host github.com
user git
identityfile ~/.ssh/id_rsa_github

host bitbucket.org
user git
identityfile ~/.ssh/id_rsa_bitbucket
```

So in the address for github `git@github.com` the part before @ `git` is the user and the part after @ is the host that is `github.com`. Similatly for bitbucket.

Once the configuration file is saved, ssh will automatically use the identity files.
